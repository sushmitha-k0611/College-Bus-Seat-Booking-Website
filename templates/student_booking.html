<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>üéüÔ∏è Student Seat Booking</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #f4f0fa;
    }

    .wrapper {
      display: flex;
      min-height: 100vh;
    }

    .sidebar {
      width: 260px;
      background: linear-gradient(180deg, #e6e0f8, #fbe9e7);
      padding: 2rem 1.2rem;
      color: #4a148c;
      border-right: 1px solid #dfcfe6;
    }

    .sidebar h4 {
      margin-bottom: 2rem;
      color: #5e35b1;
      font-weight: 600;
    }

    .nav-link {
      color: #6a1b9a;
      font-weight: 500;
      margin-bottom: 0.8rem;
      font-size: 1rem;
      padding: 8px 10px;
      border-radius: 8px;
    }

    .nav-link:hover,
    .nav-link.active {
      background-color: #ede7f6;
      padding-left: 14px;
      transition: all 0.2s ease;
    }

    .main-content {
      flex-grow: 1;
      padding: 2rem;
      max-width: 100%;
    }

    .container-custom {
      max-width: 1000px;
      margin: 0 auto;
    }

    h2, h3, label {
      color: #512da8;
    }

    .card {
      border-radius: 12px;
      border: 1px solid #decaf5;
      background-color: #ffffff;
      box-shadow: 0 2px 12px rgba(88, 65, 138, 0.05);
      padding: 1.5rem;
      margin-bottom: 2rem;
    }

    .btn-primary {
      background-color: #9575cd;
      border-color: #9575cd;
    }

    .btn-primary:hover {
      background-color: #7e57c2;
      border-color: #7e57c2;
    }

    .seat {
      width: 50px;
      height: 50px;
      margin: 5px;
      border-radius: 8px;
      background-color: #f0f0f0;
      text-align: center;
      line-height: 50px;
      cursor: pointer;
    }

    .seat.selected {
      background-color: #28a745;
      color: white;
    }

    .seat-grid {
      display: grid;
      grid-template-columns: repeat(4, 60px);
      justify-content: center;
      margin-top: 20px;
    }

    @media (max-width: 1024px) {
      .sidebar {
        display: none;
      }

      .main-content {
        padding: 1rem;
      }
    }
  </style>
</head>
<body>
<div class="wrapper">
  <!-- Sidebar -->
  <div class="sidebar">
    <h4>üìò Student Menu</h4>
    <ul class="nav flex-column">
      <li class="nav-item"><a class="nav-link" href="/student/dashboard">üè† Dashboard</a></li>
      <li class="nav-item"><a class="nav-link" href="/student/liveupdates">üìä Live Updates</a></li>
      <li class="nav-item"><a class="nav-link" href="/student/attendance">üßæ Attendance</a></li>
      <li class="nav-item"><a class="nav-link" href="/student/query">‚ùì Query</a></li>
    </ul>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <div class="container-custom">
      <h2>üéüÔ∏è Book Your Bus Seat</h2>
      <form method="POST" action="{{ url_for('check') }}" class="card mt-3">
        <div class="mb-3">
          <label class="form-label">Your Name</label>
          <input type="text" name="name" class="form-control" value="{{ session.user }}" required>
        </div>

        <div class="mb-3">
          <label class="form-label">Select Bus Number</label>
          <select name="bus_no" class="form-select" required id="busSelect">
            <option value="">-- Select Bus --</option>
            {% for bus in buses %}
              <option value="{{ bus.bus_no }}">{{ bus.bus_no }}</option>
            {% endfor %}
          </select>
        </div>

        <div class="mb-3">
          <label class="form-label">Select Stop</label>
          <select name="stop_name" class="form-select" required id="stopSelect">
            <option value="">-- Select Stop --</option>
          </select>
        </div>

        <h3 class="mt-4">ü™ë Choose Your Seat(s)</h3>
        <div class="seat-grid" id="seatGrid">
          {% for seat in range(1, 40) %}
            <div class="seat" onclick="toggleSeat(this)">{{ seat }}</div>
          {% endfor %}
        </div>

        <input type="hidden" name="seats" id="selectedSeats">
        <button type="submit" class="btn btn-primary mt-3">Book Now</button>
      </form>
    </div>
  </div>
</div>

<script>
  document.getElementById('busSelect').addEventListener('change', function () {
    const busNo = this.value;
    const stopSelect = document.getElementById('stopSelect');
    stopSelect.innerHTML = '<option value="">-- Select Stop --</option>';

    if (busNo) {
      fetch(`/get_stops?bus_no=${busNo}`)
        .then(response => response.json())
        .then(data => {
          data.forEach(function (stop) {
            const option = document.createElement('option');
            option.value = stop;
            option.textContent = stop;
            stopSelect.appendChild(option);
          });
        })
        .catch(error => {
          console.error('Error:', error);
          alert('Could not load stops.');
        });
    }
  });

  function toggleSeat(el) {
    el.classList.toggle("selected");
    const selected = [...document.querySelectorAll('.seat.selected')].map(seat => seat.textContent.trim());
    document.getElementById("selectedSeats").value = selected.join(',');
  }

  document.querySelector('form').addEventListener('submit', function (e) {
    if (!document.getElementById("selectedSeats").value) {
      alert("Please select at least one seat.");
      e.preventDefault();
    }
  });
</script>
</body>
</html>
